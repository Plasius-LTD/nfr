# AGENTS

## Purpose
This repo provides `@plasius/nfr`, a typed NFR framework for analytics, telemetry, and performance signals (React-friendly).

## Key paths
- `src/telemetry/AnalyticsProvider.tsx`: provider + context wiring
- `src/telemetry/analytics.ts`: core tracking helpers and guards
- `src/telemetry/withInteractionTracking.tsx`: HOC for interaction tracking
- `src/performance/webVitals.ts`: optional web-vitals integration
- `src/index.ts`: package exports
- `tests/`: vitest tests (jsdom)
- `dist/`: build output (generated by tsup)

## Commands
- Build: `npm run build`
- Tests: `npm test`
- Test watch: `npm run test:watch`
- Lint: `npm run lint`
- Clean: `npm run clean`

## Development notes
- `web-vitals` is an optional peer dependency; keep dynamic/guarded imports and SSR-safe paths.
- Keep React hooks and providers compatible with `react@^19`.
- Avoid heavy work at import time; prefer lazy initialization.

## Conventions
- Use Conventional Commits (see `CONTRIBUTING.md`).
- Update `README.md` and `CHANGELOG.md` for user-facing changes.
- Avoid editing `dist/` or `coverage/` by hand.
- Architectural changes require ADRs in `docs/adrs/` (or the repo ADRs folder); ensure a package-function ADR exists.

## AI guidance
- After any change, run relevant BDD/TDD tests when they exist; mention if skipped.
- For fixes, add/update a BDD or TDD test that fails first and validate it passes after the fix when possible.
- When adding or updating dependencies, prefer lazy-loading (dynamic import/code splitting) to avoid heavy first-load network use when applicable.


## Release and Quality Policy
- Update `README.md` whenever structural changes are made.
- Update `CHANGELOG.md` after every change.
- For fixes, add tests and run relevant tests before committing.
- Publish packages to npm only through GitHub CD workflows; do not publish directly from local machines.
- Maintain code coverage at 80% or higher where possible. Shader-related code is exempt.


## Plasius Package Creation Reference
- Use `/Users/philliphounslow/plasius/schema` (`@plasius/schema`) as the baseline template when creating new `@plasius/*` packages.
- Copy template runtime/tooling files at project creation: `.nvmrc` and `.npmrc`.
- Create and maintain required package docs from the start:
  - `README.md`: initialize for package purpose/API and update whenever structure or public behavior changes.
  - `CHANGELOG.md`: initialize at creation and update after every change.
  - `AGENTS.md`: include package-specific guidance and keep this policy section present.
- Include required legal/compliance files and folders used by the template/repo standards:
  - `LICENSE`
  - `SECURITY.md`
  - `CONTRIBUTING.md`
  - `legal/` documents (including CLA-related files where applicable)
- Include architecture/design documentation requirements:
  - ADRs in `docs/adrs/` for architectural decisions.
  - TDRs for technical decisions/direction.
  - Design documents for significant implementation plans and system behavior.
- Testing requirements for new packages and ongoing changes:
  - Define test scripts/strategy at creation time.
  - Create tests for all fixes and run relevant tests before committing.
  - Maintain code coverage at 80%+ where possible; shader-related code is the only coverage exception.
